{% extends 'base.html' %}

{% block head %}
    {#  replace with production vue  #}
    <link rel="stylesheet" href="{{ url_for('static', filename='css/main.css') }}">
    <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <script type="text/x-template" id="modal-template">
        <transition name="modal">
            <div class="modal-mask">
                <div class="modal-wrapper">
                    <div class="modal-container">

                        <div class="modal-header">
                            <slot name="header">
                                default header
                            </slot>
                        </div>

                        <div class="modal-body">
                            <slot name="body">
                                default body
                            </slot>
                        </div>

                        <div class="modal-footer">
                            <slot name="footer">
                                <button class="modal-default-button" @click="$emit('close')">
                                    Close
                                </button>
                            </slot>
                        </div>
                    </div>
                </div>
            </div>
        </transition>
    </script>
{% endblock %}

{% block body %}
    <div class="grid-container" id="app">
        <div class="header">
            <div id="title">Мой фотоальбом</div>
            <form action="" method="post" enctype="multipart/form-data">
                {{ form.hidden_tag() }}
                <div>
                    {{ form.image() }}
                </div>
                <div>
                    {{ form.submit() }}
                </div>
            </form>
        </div>
        <div class="main">
            <div v-if="loading">Loading...</div>
            <template v-else>
                <div class="image-container" v-for="image in paginatedData">
                    <button @click="image.showModal = true"><img class="thumbnail" :src="image.thumbnail_url" :alt="image.name"></button>
                    <modal v-if="image.showModal" >
                        <div slot="header">[[ image.name ]]</div>
                        <div slot="body"><img class="image" :src="image.file_url" :alt="image.name"></div>
                        <div slot="footer">
                            <a :href="image.file_url + '?type=attach'">Загрузить</a>
                            <button @click="deleteImage(image.id)">
                                Удалить [[ image.name ]]
                            </button>
                            <button class="modal-default-button" @click="image.showModal = false">
                                Закрыть
                            </button>
                        </div>
                    </modal>
                </div>
            </template>
        </div>
        <div class="footer">
            <template v-if="!loading">
                <button
                        :disabled="pageNumber === 0"
                        @click="prevPage">
                    <<<
                </button>
                <button
                        :disabled="pageNumber >= pageCount -1"
                        @click="nextPage">
                    >>>
                </button>
            </template>
        </div>
    </div>
    <script type="text/javascript" src="{{ url_for('static', filename='js/main.js') }}"></script>
{% endblock %}
